{% extends 'layouts/arqonz_layout.html.twig' %}
{% form_theme form 'bootstrap_4_layout.html.twig' %}

{% block content %}

    <style>
        .Register {
            display:none;
        }
        .OTPVerificationSection button {
            background: #00A79D;
            border: 0px;
            padding-bottom: 8px;
            padding-left: 25px;
            padding-right: 25px;
        }
        .OTPVerificationSection .form-group {
            margin-top: 1rem;
        }
        #resendForm button {
            
            padding-bottom: 8px;
            
            text-decoration: none;
            border-radius: 6px;
        }
        #verification-form {
            margin-top: 40px;
            text-align: center;
        }
        .FormButtonsCont {
            display: flex;
            justify-content: center;
            gap: 11px;
        }
        .alert-info {
            margin-top: 1rem;
        }
        #Step2Btn {
            
            border: 0px;
            padding-bottom: 8px;
            
        }
        .OTPVerificationSection {
            margin-top: 1rem;
        }
    </style>
    <div class="container">
        <div class="mb-5 d-flex justify-content-center">
            <div class="col-12 col-md-6" id="verification-form">
                <h2>Email Verification</h2>

                <p>Weâ€™ve sent a 6-digit OTP (One-Time Password) to your registered email address. Please enter the OTP below to verify your email and continue.</p>

                

                    <div class="OTPVerificationSection">
                        {# Success Message and Button #}
                        {% if EmailverificationStatus == 'success' %}
                            <div class="alert alert-success">
                                Your email has been successfully verified!
                            </div>

                        {% else %}
                            {# Failure and Resend OTP Messages #}
                            {% if EmailverificationStatus == 'failure' %}
                                <div class="alert alert-danger">
                                    Invalid OTP. Please try again.
                                </div>
                            {% endif %}
                            {% if EmailotpResent %}
                                <div class="alert alert-info">
                                    A new OTP has been sent to your email address.
                                </div>
                            {% endif %}

                            {# Verification Form #}
                            {{ form_start(form) }}
                                <div class="form-group">
                                    {{ form_row(form.EmailOTP, { 'attr': {'placeholder': 'Enter Email OTP'} }) }}
                                </div>
                                <div class="FormButtonsCont">

                                    
                                </div>
                            
                    </div>

                    
                    
                {% endif %}

                <div class="OTPVerificationSection">
                    {# Success Message and Button #}
                    {% if PhoneverificationStatus == 'success' %}
                        <div class="alert alert-success">
                            Your Phone has been successfully verified!
                        </div>
                        <a href="{{ path('account-login-test') }}" class="btn btn-primary" id="Step2Btn">Login To your Account</a>
                    {% else %}
                        {# Failure and Resend OTP Messages #}
                        {% if PhoneverificationStatus == 'failure' %}
                            <div class="alert alert-danger">
                                Invalid OTP. Please try again.
                            </div>
                        {% endif %}
                        {% if PhoneotpResent %}
                            <div class="alert alert-info">
                                A new OTP has been sent to your Whatsapp.
                            </div>
                        {% endif %}

                        {# Verification Form #}
                        {{ form_start(form) }}
                            <div class="form-group">
                                {{ form_row(form.PhoneOTP, { 'attr': {'placeholder': 'Enter Phone OTP'} }) }}
                            </div>
                            
                            <div class="FormButtonsCont">
                                    
                                {{ form_end(form) }}

                                {# Resend OTP Button #}
                                <form method="get" id="resendForm" action="{{ app.request.uri }}">
                                    <input type="hidden" name="phone_resend_otp" value="1">
                                    <button type="submit" style="background: unset; padding-left: 0px; padding-right: 25px;" class="btn btn-link mt-3">Phone OTP Resend</button>
                                </form>

                                {# Resend OTP Button #}
                                <form method="get" id="resendForm" action="{{ app.request.uri }}">
                                    <input type="hidden" name="Email_resend_otp" value="1">
                                    <button type="submit" style="background: unset; padding-left: 0px; padding-right: 25px;" class="btn btn-link mt-3">Email OTP Resend</button>
                                </form>
                            </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Get references to input fields and the submit button
            const emailOtpField = document.getElementById("combined_verification_form_EmailOTP");
            const phoneOtpField = document.getElementById("combined_verification_form_PhoneOTP");
            const submitButton = document.getElementById("combined_verification_form__submit");

            // Disable the submit button initially
            submitButton.disabled = true;

            // Helper function to check if both fields have 6 digits
            function validateForm() {
                const emailOtpValue = emailOtpField.value;
                const phoneOtpValue = phoneOtpField.value;
                if (emailOtpValue.length === 6 && phoneOtpValue.length === 6) {
                    submitButton.disabled = false;
                } else {
                    submitButton.disabled = true;
                }
            }

            // Function to restrict input to digits and limit to 6 characters
            function handleInput(event) {
                const inputField = event.target;

                // Remove any non-digit characters
                inputField.value = inputField.value.replace(/\D/g, "");

                // Limit to 6 characters
                if (inputField.value.length > 6) {
                    inputField.value = inputField.value.slice(0, 6);
                }

                // Validate the form
                validateForm();
            }

            // Attach input event listeners to both fields
            emailOtpField.addEventListener("input", handleInput);
            phoneOtpField.addEventListener("input", handleInput);
        });
    </script>
{% endblock %}
