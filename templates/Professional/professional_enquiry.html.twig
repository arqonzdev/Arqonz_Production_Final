{% extends 'layouts/UserDashboard_layout.html.twig' %}

{% block content %}

<div class="dashboard-projects">
    <span>
        <span class="Breadcrumb-nonactive"><a href="/en/account/index">Dashboard</a></span><span class="breadcrumb-divider">></span><span class="Breadcrumb-nonactive"><a href="/account/Enquiries">Enquiries</a></span><span class="breadcrumb-divider">></span><span class="Breadcrumb-active">Enquiry Detail</span>
    </span>
</div>
<div class="line-8"></div>

<div class="dashboard-container">
        <div class="left-column" style="width: 100%; justify-content:center;">
            <!-- ArchitectProjects -->
            <div class="projectssection">
                <div class="dashboardheading-section">
                    <div class="sectionheading">
                        <h2>Enquiry Details</h2>
                        <p class="sectionsubheading">Unlock and view enquiry.</p> 
                    </div>
                </div>

                <div class="SingleEnquiryDetail">
                    {% if Unlock == 'true'%}
                        <div class="EnquiryField"> 
                            <p class="EnquiryFieldLabel">Name: </p>
                            <span class="Unhiddenfield Field">{{ ProEnquiry.getfullname() }}</span>
                        </div>
                        <div class="EnquiryField"> 
                            <p class="EnquiryFieldLabel">Email: </p>
                            <span class="Unhiddenfield Field">{{ ProEnquiry.getEmail() }}</span>
                        </div>
                        <div class="EnquiryField"> 
                            <p class="EnquiryFieldLabel">Phone: </p>
                            <span class="Unhiddenfield Field">{{ ProEnquiry.getPhone() }}</span>
                        </div>
                        <div class="EnquiryField"> 
                            <p class="EnquiryFieldLabel">Message: </p>
                            <span class="Unhiddenfield Field">{{ ProEnquiry.getMessage() }}</span>
                        </div>
                    {% endif %}

                    {% if Unlock != 'true'%}
                        <div class="EnquiryField"> 
                            <p class="EnquiryFieldLabel">Name: </p>
                            <span class="Unhiddenfield Field">{{ ProEnquiry.getfullname() }}</span>
                        </div>
                        <div class="EnquiryField"> 
                            <p class="EnquiryFieldLabel">Email: </p>
                            <span class="hiddenfield Field"><i class="fa-solid fa-lock-keyhole"></i></span>
                        </div>
                        <div class="EnquiryField"> 
                            <p class="EnquiryFieldLabel">Phone: </p>
                            <span class="hiddenfield Field"><i class="fa-solid fa-lock-keyhole"></i></span>
                        </div>
                        <div class="EnquiryField"> 
                            <p class="EnquiryFieldLabel">Message: </p>
                            <span class="Unhiddenfield Field">{{ ProEnquiry.getMessage() }}</span>
                        </div>

                        {% if customer.CreditPoints() < 1 %}
                            <div class="buyCreditsbutton">
                                <a href="/account/pricing" id="unlockButton" class="btn btn-lg btn-block btn-success btn"><img src="/static/icons/Buy-Credits-icon.svg" alt=""> Buy Credits</a>
                            </div>

                            <div class="OneTimePurchaseBtn buyCreditsbutton">
                                <button id="unlockOnceButton" class="btn btn-lg btn-block btn-primary btn mt-3"><i class="fa-solid fa-unlock"></i> Unlock This (â‚¹100)</button>
                            </div>

                            <style>
                                #unlockOnceButton {
                                    padding: 20px 30px;
                                    border-radius: 10px;
                                    background: #23262F;
                                    color: #fff;
                                    font-weight: 400;
                                    font-size: 18px;
                                    cursor: pointer;
                                }
                            </style>

                            <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
                            <script>
                                document.addEventListener('DOMContentLoaded', function() {
                                    const unlockOnceButton = document.getElementById('unlockOnceButton');
                                    if (unlockOnceButton) {
                                        unlockOnceButton.addEventListener('click', function(e) {
                                            e.preventDefault();
                                            
                                            // Send AJAX request to create one-time unlock order
                                            fetch('{{ path('create_unlock_order') }}', {
                                                method: 'POST',
                                                headers: {
                                                    'Content-Type': 'application/x-www-form-urlencoded',
                                                    'X-Requested-With': 'XMLHttpRequest'
                                                },
                                                body: 'enquirytype={{ enquirytype }}&url={{ url }}'
                                            })
                                            .then(response => response.json())
                                            .then(data => {
                                                if (data.error) {
                                                    alert(data.error);
                                                    return;
                                                }

                                                var options = {
                                                    "key": data.razorpayKey,
                                                    "amount": data.amount,
                                                    "currency": "INR",
                                                    "name": data.name,
                                                    "description": data.description,
                                                    "order_id": data.orderId,
                                                    "handler": function(response) {
                                                        window.location.href = "{{ path('verify_unlock_payment') }}?payment_id=" + 
                                                            response.razorpay_payment_id + 
                                                            "&order_id=" + response.razorpay_order_id + 
                                                            "&razorpay_signature=" + response.razorpay_signature +
                                                            "&enquirytype={{ enquirytype }}" +
                                                            "&url={{ url }}";
                                                    },
                                                    "theme": {
                                                        "color": "#3399cc"
                                                    }
                                                };
                                                var rzp1 = new Razorpay(options);
                                                rzp1.open();
                                            })
                                            .catch(error => console.error('Error:', error));
                                        });
                                    }
                                });
                            </script>

                        {% endif %}

                        {% if customer.CreditPoints() > 0 %}
                            <div class="buyCreditsbutton">
                                <button id="unlockButton" class="btn btn-lg btn-block btn-success btn"><i class="fa-solid fa-lock-keyhole-open"></i> Unlock Now</button>
                            </div>

                        {% endif %}

                        


                    {% endif %}
                </div>
            </div> 
        </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('unlockButton').addEventListener('click', function(e) {
            window.location.href = "{{ path('Enquiry-page-unlock', {'enquirytype': enquirytype, 'url': url}) }}";
        });
    });
</script>    
    
{% endblock %}

{# <div class="enquirybox">
    <div class="enquirycontent">
        {% if Unlock != 'true'%}
        <center><h2 class="mainheading">Enquiry Details</h2></center>
        <p><div class="EnquiryField">Name: <span class="hiddenfield"> {{ ProEnquiry.getfullname() }}</span></div></p>
        <p><div class="EnquiryField">Email: <span class="hiddenfield"><i class="fa-solid fa-lock-keyhole"></i></span></div></p>
        <p><div class="EnquiryField">Phone: <span class="hiddenfield"><i class="fa-solid fa-lock-keyhole"></i> </span></div></p>
        <p><div class="EnquiryField">Message: <span class="hiddenfield"> {{ ProEnquiry.getMessage() }}</span></div></p>
        
        <button id="unlockButton" class="btn btn-lg btn-block btn-success btn"><i class="fa-solid fa-lock-keyhole-open"></i> Unlock Now</button>
        <a href="/account/pricing" id="unlockButton" class="btn btn-lg btn-block btn-success btn"><i class="fa-solid fa-coin"></i> Buy Credits</a>
        {% endif %}

        {% if Unlock == 'true'%}
        <center><h2 class="mainheading">Enquiry Details</h2></center>
        <p><div class="EnquiryField">Name: <span class="hiddenfield"> {{ ProEnquiry.getfullname() }}</span></div></p>
        <p><div class="EnquiryField">Email: <span class="hiddenfield"> {{ ProEnquiry.getEmail() }}</span></div></p>
        <p><div class="EnquiryField">Phone: <span class="hiddenfield"> {{ ProEnquiry.getPhone() }}</span></div></p>
        <p><div class="EnquiryField">Message: <span class="hiddenfield"> {{ ProEnquiry.getMessage() }}</span></div></p>
        {% endif %}
        
    </div>
</div>




{% endblock %}
 #}
