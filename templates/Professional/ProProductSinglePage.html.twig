{% extends 'layouts/arqonz_updated_layout.html.twig' %}

{% block content %}
<link rel="stylesheet" href="/static/css/ArqonzWebsite-Pages.css">
<link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.1/css/all.css">

<style>
/* Form field styling - uniform full width */
.ProdEnquiryFormFields input[type="text"],
.ProdEnquiryFormFields input[type="email"],
.ProdEnquiryFormFields input[type="number"],
.ProdEnquiryFormFields textarea {
    width: 100%;
    border-radius: 8px;
    border: 1px solid #ddd;
    padding: 12px 15px;
    font-size: 14px;
    transition: border-color 0.3s ease;
    margin-bottom: 15px;
    box-sizing: border-box;
}

.ProdEnquiryFormFields input[type="text"]:focus,
.ProdEnquiryFormFields input[type="email"]:focus,
.ProdEnquiryFormFields input[type="number"]:focus,
.ProdEnquiryFormFields textarea:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
}

.ProdEnquiryFormFields textarea {
    min-height: 100px;
    resize: vertical;
}

/* Submit button styling */
.submit-button {
    width: 100%;
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 15px 20px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 10px;
    box-shadow: 0 2px 10px rgba(0, 123, 255, 0.2);
}

.submit-button:hover {
    background: linear-gradient(135deg, #0056b3, #004085);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
}

.submit-button:active {
    transform: translateY(0);
    box-shadow: 0 2px 10px rgba(0, 123, 255, 0.2);
}
</style>

<div class="productsPageMain">
    <div class="ProductsHero">
        <div class="productGallery">
            <div class="productSlider">
                {% if ProProject.getProductImage() and ProProject.getProductImage().getItems()|length > 0 %}
                    {% for item in ProProject.getProductImage().getItems() %}
                        {% if item.getImage() %}
                            <div class="slide">
                                <img src="{{ item.getImage().getThumbnail('galleryCarousel').getPath() }}" alt="Product Image">
                            </div>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <div class="slide">
                        <img src="{{ pimcore_asset_by_path('/Static/DefaultImage.jpeg').getThumbnail('galleryCarousel').getPath() }}" alt="Default Product Image">
                    </div>
                {% endif %}
            </div>
            <div class="dots">
                {% if ProProject.getProductImage() and ProProject.getProductImage().getItems()|length > 0 %}
                    {% for item in ProProject.getProductImage().getItems() %}
                        {% if item.getImage() %}
                            <span class="dot"></span>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <span class="dot"></span>
                {% endif %}
            </div>

            <script>
                let slideIndex = 0;
                showSlides(slideIndex);

                function showSlides(n) {
                    let slides = document.querySelectorAll('.productSlider .slide');
                    let dots = document.querySelectorAll('.dot');
                    if (n >= slides.length) { slideIndex = 0 }
                    if (n < 0) { slideIndex = slides.length - 1 }
                    for (let i = 0; i < slides.length; i++) {
                        slides[i].style.transform = `translateX(-${slideIndex * 100}%)`;
                    }
                    for (let i = 0; i < dots.length; i++) {
                        dots[i].className = dots[i].className.replace(" active", "");
                    }
                    dots[slideIndex].className += " active";
                }

                document.querySelectorAll('.dot').forEach((dot, index) => {
                    dot.addEventListener('click', () => {
                        slideIndex = index;
                        showSlides(slideIndex);
                    });
                });
            </script>
        </div>
        <div class="productMainDetails">
            <h2>{{ ProProject.getProductName() }}</h2>
            <div class="ProdReviewRatings">
                <div class="rating-stars" style="display: flex; align-items: center; margin-bottom: 5px;">
                    {% for i in 1..5 %}
                        <span style="color: {{ i <= averageRating ? '#ffc107' : '#e1e5e9' }}; font-size: 18px; margin-right: 2px;">★</span>
                    {% endfor %}
                    <span style="margin-left: 8px; font-weight: 600; color: #333;">{{ averageRating }}/5</span>
                </div>
                <p style="color: #666; font-size: 14px; margin: 0;">({{ totalReviews }} Review{{ totalReviews != 1 ? 's' : '' }})</p>
            </div>
            <div class="productPrice">
                <p class="ProductcardPrice" style="justify-content: left;">
                    <span class="ProdPriceRs">
                        <span class="RupeeSymbol">₹</span> 
                        <span class="ProductPriceAmt">{{ ProProject.getPrice() }}</span>
                        <span class="PriceUnits">{{ ProProject.getUnit() }}</span>
                    </span>
                </p>
            </div>
            <div class="ProdDescSnippet">
                <p>{{ ProProject.getProductDescription()|length > 231 ? ProProject.getProductDescription()|slice(0, 231) ~ '...' : ProProject.getProductDescription() }}</p>
            </div>
            <div class="ProdManufacturer">
                <img src="/static/icons/ProdManufacturer.svg" alt="">
                <p class="blurred-text">: {{ architectProfile.getCompanyName() }}</p>
            </div>
            <div class="ProdStarSpecifications">
                <p><span class="specLable">Brand</span><span class="SpecValue"> : {{ ProProject.getProductBrand() }}</span></p>
                {% if ProProject.getMaterial() %}
                    <p><span class="specLable">Material</span><span class="SpecValue"> : {{ ProProject.getMaterial() }}</span></p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="ProdDescriptionEnquiry">
        <div class="ProductinfDescription">
            <div class="ProductDetailsMenu">
                <a href="" class="Description selected">
                    <img class="DetMenuImage" src="/static/icons/ProductsDescription.svg" alt="">
                    <span class="DetmenuName">Description</span>
                </a>

                <a href="" class="Specification">
                    <img class="DetMenuImage" src="/static/icons/Specifications.svg" alt="">
                    <span class="DetmenuName">Specifications</span>
                </a>
            </div>
            <p class="ProdDataDescription">{{ ProProject.getProductDescription() }}</p>
            <div class="ProdComplSpecifications">
                {% if ProProject.getSpecifications() %}
                    <p><span class="specLable">Specifications</span><span class="SpecValue"> : {{ ProProject.getSpecifications() }}</span></p>
                {% endif %}
                {% if ProProject.getProductBrand() %}
                    <p><span class="specLable">Brand</span><span class="SpecValue"> : {{ ProProject.getProductBrand() }}</span></p>
                {% endif %}
                {% if ProProject.getMaterial() %}
                    <p><span class="specLable">Material</span><span class="SpecValue"> : {{ ProProject.getMaterial() }}</span></p>
                {% endif %}
                {% if ProProject.getUnit() %}
                    <p><span class="specLable">Unit</span><span class="SpecValue"> : {{ ProProject.getUnit() }}</span></p>
                {% endif %}
                {% if ProProject.getParentCategory() %}
                    <p><span class="specLable">Category</span><span class="SpecValue"> : {{ ProProject.getParentCategory() }}</span></p>
                {% endif %}
                {% if ProProject.getSubCategory() %}
                    <p><span class="specLable">Sub Category</span><span class="SpecValue"> : {{ ProProject.getSubCategory() }}</span></p>
                {% endif %}
                {% if ProProject.getSubSubCategory() %}
                    <p><span class="specLable">Sub Sub Category</span><span class="SpecValue"> : {{ ProProject.getSubSubCategory() }}</span></p>
                {% endif %}
                {% if ProProject.getTags() %}
                    <p><span class="specLable">Tags</span><span class="SpecValue"> : {{ ProProject.getTags() }}</span></p>
                {% endif %}
            </div>

            <div class="productReviewForm">
                <h3>Rate this Product</h3>
                
                {% if is_granted('IS_AUTHENTICATED_REMEMBERED') %}
                    <form id="productReviewForm">
                        <div class="rating">
                            <label for="rating">Rating:</label>
                            <div class="stars">
                                {% for i in 5..1 %}
                                    <input type="radio" id="star{{ i }}" name="rating" value="{{ i }}" required />
                                    <label for="star{{ i }}" title="{{ i }} stars">
                                        &#9733;
                                    </label>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="review">
                            <label for="review">Review:</label>
                            <textarea id="review" name="review" rows="4" placeholder="Write your review here..." required></textarea>
                        </div>
                        <div class="submit">
                            <input type="submit" value="Submit Review">
                        </div>
                    </form>
                {% else %}
                    <div class="login-prompt" style="text-align: center; padding: 20px; background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; margin: 20px 0;">
                        <p style="margin-bottom: 15px; color: #6c757d; font-size: 16px;">Login to leave a Review</p>
                        <a href="/account/sign-in" class="btn btn-primary" style="text-decoration: none;">Login</a>
                    </div>
                {% endif %}
            </div>
            
            {% if is_granted('IS_AUTHENTICATED_REMEMBERED') %}
            <script>
                document.getElementById('productReviewForm').addEventListener('submit', function(event) {
                    event.preventDefault();
            
                    const formData = new FormData(this);
                    formData.append('productUrl', window.location.href);
            
                    fetch('/product-review-submit', {
                        method: 'POST',
                        body: formData,
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Thank you for your review!');
                            document.getElementById('productReviewForm').reset(); // Clears the form fields
                        } else {
                            alert('There was an issue submitting your review. Please try again.');
                        }
                    })
                    .catch(error => {
                        alert('An error occurred while submitting your review. Please try again.');
                    });
                });
            </script>
            {% endif %}

            <!-- Reviews Display Section -->
            <div class="productReviewsSection" style="margin-top: 20px;">
                <h3 style="margin-bottom: 30px; color: #333; font-size: 24px; font-weight: 600;">Customer Reviews</h3>
                
                {% if reviews.items|length > 0 %}
                    <div class="reviewsContainer">
                        {% for review in reviews.items %}
                            <div class="reviewItem" style="background: #fff; border: 1px solid #e1e5e9; border-radius: 12px; padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                                <div class="reviewHeader" style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px;">
                                    <div class="reviewerInfo">
                                        <div class="reviewerName" style="font-weight: 600; color: #333; font-size: 16px; margin-bottom: 4px;">
                                            {% if review.customer %}
                                                {{ review.customer.firstname }} {{ review.customer.lastname }}
                                            {% else %}
                                                Anonymous
                                            {% endif %}
                                        </div>
                                        <div class="reviewDate" style="color: #666; font-size: 14px;">
                                            {{ review.creationDate|date('M d, Y') }}
                                        </div>
                                    </div>
                                    <div class="reviewRating" style="display: flex; align-items: center;">
                                        {% for i in 1..5 %}
                                            <span style="color: {{ i <= review.rating ? '#ffc107' : '#e1e5e9' }}; font-size: 18px;">★</span>
                                        {% endfor %}
                                        <span style="margin-left: 8px; color: #666; font-size: 14px;">({{ review.rating }}/5)</span>
                                    </div>
                                </div>
                                <div class="reviewContent" style="color: #555; line-height: 1.6; font-size: 15px;">
                                    {{ review.review }}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Pagination -->
                    {% if reviews.pageCount > 1 %}
                        <div class="reviewsPagination" style="margin-top: 30px; text-align: center;">
                            <nav aria-label="Reviews pagination">
                                <ul class="pagination" style="display: inline-flex; list-style: none; padding: 0; margin: 0;">
                                    {% if reviews.currentPageNumber > 1 %}
                                        <li class="page-item">
                                            <a class="page-link" href="{{ path('Manufacturer_product_single', {'CustomerType': CustomerType, 'url': ProProject.key, 'page': reviews.currentPageNumber - 1}) }}" 
                                            style="padding: 8px 16px; margin: 0 4px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; color: #007bff; text-decoration: none; transition: all 0.2s;">
                                                Previous
                                            </a>
                                        </li>
                                    {% endif %}
                                    
                                    {% for page in 1..reviews.pageCount %}
                                        <li class="page-item">
                                            <a class="page-link" href="{{ path('Manufacturer_product_single', {'CustomerType': CustomerType, 'url': ProProject.key, 'page': page}) }}" 
                                            style="padding: 8px 16px; margin: 0 4px; background: {{ page == reviews.currentPageNumber ? '#007bff' : '#f8f9fa' }}; border: 1px solid #dee2e6; border-radius: 6px; color: {{ page == reviews.currentPageNumber ? '#fff' : '#007bff' }}; text-decoration: none; transition: all 0.2s;">
                                                {{ page }}
                                            </a>
                                        </li>
                                    {% endfor %}
                                    
                                    {% if reviews.currentPageNumber < reviews.pageCount %}
                                        <li class="page-item">
                                            <a class="page-link" href="{{ path('Manufacturer_product_single', {'CustomerType': CustomerType, 'url': ProProject.key, 'page': reviews.currentPageNumber + 1}) }}" 
                                            style="padding: 8px 16px; margin: 0 4px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; color: #007bff; text-decoration: none; transition: all 0.2s;">
                                                Next
                                            </a>
                                        </li>
                                    {% endif %}
                                </ul>
                            </nav>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="noReviews" style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 12px; color: #666;">
                        <p style="font-size: 16px; margin: 0;">No reviews yet. Be the first to review this product!</p>
                    </div>
                {% endif %}
            </div>

        </div>

        

        <div class="ProductEnquiryForm">
            <h3>Need Bulk Orders ?</h3>
            <div class="ProdsellerInfo">
                <div class="SellerImage">
                    {% if architectProfile.getProfileImage() %}
                        <img src="{{ architectProfile.getProfileImage().getThumbnail('galleryCarousel').getPath() }}" alt="Seller Image">
                    {% else %}
                        <img src="/static/icons/boy-avator-1.svg" alt="Default Seller Image">
                    {% endif %}
                </div>
                <div class="sellerInfo">
                    <p class="SellerInfoTag">Seller Information</p>
                    <p class="SellerInfoName">{{ architectProfile.getCompanyName() }}</p>
                    <p class="SellerInfoDescription">{{ architectProfile.getDescription()|slice(0, 100) }}{% if architectProfile.getDescription()|length > 100 %}...{% endif %}</p>
                </div>
            </div>
        
            <div class="ProdEnquiryFormFields">
                {{ form_start(form) }}
                    {{ form_widget(form.fullname, {'attr': {'placeholder': 'Enter Full Name *'}}) }}
                    {{ form_widget(form.Phone, {'attr': {'placeholder': 'Enter Phone Number *'}}) }}
                    {{ form_widget(form.Email, {'attr': {'placeholder': 'Enter Email Address *'}}) }}
                    {{ form_widget(form.City, {'attr': {'placeholder': 'Enter City'}}) }}
                    {{ form_widget(form.Message, {'attr': {'placeholder': 'Enter your message... *'}}) }}
                    {{ form_widget(form._submit, {'attr': {'class': 'submit-button'}}) }}
                {{ form_end(form) }}
            </div>
        </div>
    </div>

        
    </div>

    <hr style="border-top: 1px solid #EEF2F5; border-bottom: 0px; margin: 50px 0px;">

    <div class="AdminqueriesSection">
        <div class="AdminEmailSection">
            <div class="AdminQueriesIcon">
                <img src="/static/icons/AdminQueriesEmail.svg" alt="">
            </div>
            <div class="AdminQueriesDetails">
                <p class="AdminQueryLabel">admin@arqonz.com</p>
                <p class="AdminQueryValue">Have query? Mail us.</p>
            </div>
        </div>
        <div class="AdminPhoneSection">
            <div class="AdminQueriesIcon">
                <img src="/static/icons/AdminQueriesPhone.svg" alt="">
            </div>
            <div class="AdminQueriesDetails">
                <p class="AdminQueryLabel">+91 79000 85000 </p>
                <p class="AdminQueryValue">24/7 available</p>
            </div>
        </div>
    </div>
</div>

{# Toggle Description and Specification Javascript #}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const descriptionLink = document.querySelector('.ProductDetailsMenu .Description');
        const specificationLink = document.querySelector('.ProductDetailsMenu .Specification');
        const prodDataDescription = document.querySelector('.ProdDataDescription');
        const prodComplSpecifications = document.querySelector('.ProdComplSpecifications');

        function updateSelection(selectedLink) {
            // Remove 'selected' class from both links
            descriptionLink.classList.remove('selected');
            specificationLink.classList.remove('selected');

            // Add 'selected' class to the clicked link
            selectedLink.classList.add('selected');
        }

        function toggleContent(selectedLink) {
            if (selectedLink.classList.contains('Description')) {
                // Show the description and hide the specifications
                prodDataDescription.style.display = 'block';
                prodComplSpecifications.style.display = 'none';
            } else if (selectedLink.classList.contains('Specification')) {
                // Show the specifications and hide the description
                prodDataDescription.style.display = 'none';
                prodComplSpecifications.style.display = 'block';
            }
        }

        // Event listeners for the description and specification links
        descriptionLink.addEventListener('click', function (e) {
            e.preventDefault(); // Prevent the default anchor behavior
            updateSelection(descriptionLink);
            toggleContent(descriptionLink);
        });

        specificationLink.addEventListener('click', function (e) {
            e.preventDefault(); // Prevent the default anchor behavior
            updateSelection(specificationLink);
            toggleContent(specificationLink);
        });
    });
</script>

{% endblock %}