{% extends 'layouts/arqonz_layout.html.twig' %}
{% do pimcore_head_link().appendStylesheet('/static/css/arqonz_architectprofile.css') %}
{% do pimcore_head_link().appendStylesheet('https://site-assets.fontawesome.com/releases/v6.5.1/css/all.css') %}
{% form_theme form 'bootstrap_3_layout.html.twig' %}

{% block content %}

    <div id="main-content" class="main-content mb-5">
    
        {# <div class="page-header">
            <h1>{{ architectProfile.getCompanyName() }}</h1>
        </div> #}

        <div class="architect-profile">

            <div class="profile-image">
                {% if architectProfile.getProfileImage() %}
                    <img src="{{ architectProfile.getProfileImage().getThumbnail("galleryCarousel") }}" alt="Profile Image" class="profile-image">
                {% else %}
                   <img src="{{ pimcore_asset_by_path('/Static/DefaultImage.jpeg').getThumbnail("galleryCarousel") }}" alt="Profile Image" class="profile-image">
                {% endif %}
            </div>

            <div class="profile-details">
                <div class="over-image">
                    <div class="left-row">
                        <div class="company-name">
                            <h1>{{ architectProfile.getCompanyName() }}</h1>
                            <div class="architectcity">
                            <p>{{ architectProfile.getCity() }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="right-row">
                        <div class="Stars">
                            {% set rating = architectProfile.getCalculatedRating() %}
                            {% set fullStars = rating | round(0, 'floor') %}
                            {% set hasHalfStar = (rating - fullStars) >= 0.5 %}
                            <p>
                            {% for i in range(1, 5) %}
                                {% if i <= fullStars %}
                                    <span class="fa fa fa-star checked" style="color: orange;"></span>
                                {% elseif hasHalfStar %}
                                    {% set hasHalfStar = false %}
                                    <span class="fa-solid fa-star-half-stroke" style="color: orange;"></span>
                                {% else %}
                                    <span class="fa fa-regular fa-star"></span>
                                {% endif %}
                            {% endfor %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="portfolio-content">
                <div class="p-left-row">
                    <div class="portfolio-attributes">
                        {% if architectProfile.getPortfolioType() != 'Manufacturer' and architectProfile.getPortfolioType() != 'Distributor' %}
                            <div class="attributebox">
                                <p><i class="fas fa-money-check" aria-hidden="true" style="font-size:17px;"></i> Service Price</p>
                                <b>â‚¹ {{ architectProfile.PriceForHour() }}/Hr</b>
                            </div>
                        {% endif %}
                        
                        {% if architectProfile.getPortfolioType() != 'Manufacturer' and architectProfile.getPortfolioType() != 'Distributor' and architectProfile.getPortfolioType() != 'Retailer' and architectProfile.getPortfolioType() != 'Dealer' %}
                            <div class="attributebox">
                            <p><i class="fas fa-briefcase" aria-hidden="true" style="font-size:17px;"></i> Projects Completed</p>
                            <b>{{ numberOfProjects }}</b>
                            </div>
                        {% endif %}
                        {% if architectProfile.getPortfolioType() == 'Manufacturer' or architectProfile.getPortfolioType() == 'Distributor' or architectProfile.getPortfolioType() == 'Retailer' or architectProfile.getPortfolioType() == 'Dealer' %}
                            <div class="attributebox">
                            <p><i class="fas fa-briefcase" aria-hidden="true" style="font-size:17px;"></i> Products</p>
                            <b>{{ numberOfProducts }}</b>
                            </div>
                        {% endif %}
                        <div class="attributebox">
                            <p><i class="fas fa-user-tie" aria-hidden="true" style="font-size:17px;"></i> Work Experience</p>
                            <b>{{ architectProfile.Experience() }} Years</b>
                        </div>
                    </div>
                    <div class="profile-details">
                        <h2>Get to Know {{ architectProfile.getCompanyName() }}</h2>
                        <p>Joined in {{creationdate}}</p>
                    </div>
                    <div class="secondary-attributes">
                        <div class="Lrow">
                            <p><i class="fa-solid fa-badge-check" style="font-size:19px;color:#4ba75a;"></i> Verified By Arqonz</p>
                            <p><i class="fas fa-star" style="font-size:19px;color:#f8c246"></i> {{rating}} (5 Reviews)</p>
                        </div>
                        <div class="Rrow">
                            <p><i class="fad fa-city" style="font-size:19px;color:#9d9d9d"></i> Cities Served</p>
                            <div class="citylist">
                                {% set cities = architectProfile.CitiesServed() | split(',') %}
                                {% for city in cities %}
                                    <div class="citytagbox">
                                        <p>{{ city|trim }}</p>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    
                    {% if architectProfile.getPortfolioType() != 'Manufacturer' and architectProfile.getPortfolioType() != 'Distributor'%}
                        <div class="skills">
                        <h2>Skills</h2>
                        <div class="citylist">
                            {% set skills = architectProfile.Skills() | split(',') %}
                            {% for skill in skills %}
                                    <div class="skilltagbox">
                                        <p>{{ skill|trim }}</p>
                                    </div>
                                {% endfor %}
                            
                        </div>
                    </div>
                    {% endif %}
                        
                    <div class="Architect-description">
                        <h2>Description</h2>
                        {# {% set bio = architectProfile.getBio() %}
                        {% if bio|length > 150 %}
                            <p>{{ bio|slice(0, 150) ~ ' (...)' }}</p>
                        {% else %}
                            <p>{{ bio }}</p>
                        {% endif %} #}
                        <p>{{ architectProfile.getDescription() }}</p>
                    </div>

                    {% if architectProfile.getPortfolioType() not in ['Manufacturer', 'Dealer', 'Distributor', 'Retailer']%}
                        <div class="portfolio-projects">
                            <h2>Portfolio Projects</h2>
                            <div class="project-list">
                                {% for project in pagination %}
                                    {% include '/Professional/project_listing_card.html.twig' with {'project': project, 'portfolioType': architectProfile.getPortfolioType(),} %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="pagination">
                            {% include 'includes/projectpagination.html.twig' with {'paginationVariables': paginationVariables} %}
                        </div>
                    {% endif %}
                    {% if architectProfile.getPortfolioType() in ['Manufacturer', 'Dealer', 'Distributor', 'Retailer'] %}
                        <div class="portfolio-projects">
                            <h2>Products List</h2>
                            <div class="project-list">
                                {% for product in pagination %}
                                    {% include '/Professional/project_listing_card.html.twig' with {'project': product, 'portfolioType': architectProfile.getPortfolioType(), 'listingtype':'Manufacturer'} %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="pagination">
                            {% include 'includes/projectpagination.html.twig' with {'paginationVariables': paginationVariables} %}
                        </div>
                    {% endif %}


                    <!-- User Reviews -->

                        <div class="reviews-section">
                            <h3>Customer Reviews</h3>
                            
                            {% if reviews|length > 0 %}
                                <div class="reviews-container">
                                    {% for review in reviews %}
                                        {% set reviewer = review.getProfessional().getCustomer() %}
                                        <div class="review-card">
                                            <div class="review-header">
                                                <div class="reviewer-info">
                                                    <div class="reviewer-name">{{ reviewer.getFirstname() }} {{ reviewer.getLastname() }}</div>
                                                    <div class="review-date">{{ review.getCreationDate()|date('M d, Y') }}</div>
                                                </div>
                                                <div class="review-rating">
                                                    {% for i in 1..5 %}
                                                        {% if i <= review.getRating() %}
                                                            <span class="fa fa-star checked" style="color: orange;"></span>
                                                        {% else %}
                                                            <span class="fa fa-regular fa-star"></span>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                            <div class="review-content">
                                                {{ review.getReview() }}
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="no-reviews">No reviews yet. Be the first to review!</p>
                            {% endif %}
                        </div>

                        <style>
                            /* Reviews Section Styles */
                            .reviews-section {
                                margin: 50px 0;
                                padding: 30px 0;
                                border-top: 1px solid #EEF2F5;
                            }
                            
                            .reviews-section h3 {
                                font-size: 40px !important;
                                font-weight: 600 !important;
                                margin-bottom: 30px;
                            }
                            
                            .reviews-container {
                                display: flex;
                                flex-direction: column;
                                gap: 30px;
                            }
                            
                            .review-card {
                                background: #fff;
                                border-radius: 8px;
                                padding: 25px;
                                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
                            }
                            
                            .review-header {
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                margin-bottom: 15px;
                            }
                            
                            .reviewer-info {
                                display: flex;
                                flex-direction: column;
                            }
                            
                            .reviewer-name {
                                font-weight: 600;
                                font-size: 18px;
                            }
                            
                            .review-date {
                                color: #777;
                                font-size: 14px;
                                margin-top: 3px;
                            }
                            
                            .review-rating {
                                display: flex;
                                gap: 3px;
                            }
                            
                            .review-content {
                                line-height: 1.6;
                                color: #333;
                            }
                            
                            .no-reviews {
                                color: #777;
                                font-style: italic;
                            }
                        </style>

                    <!-- User Reviews Ends -->


                    {% if app.user %}

                    <div class="productReviewForm">
                        <h3>Rate this Professional</h3>
                        <form id="productReviewForm">
                            <div class="rating">
                                <label for="rating">Rating:</label>
                                <div class="stars">
                                    {% for i in 5..1 %}
                                        <input type="radio" id="star{{ i }}" name="rating" value="{{ i }}" />
                                        <label for="star{{ i }}" title="{{ i }} stars">
                                            &#9733;
                                        </label>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="review">
                                <label for="review">Review:</label>
                                <textarea id="review" name="review" rows="4" placeholder="Write your review here..." required></textarea>
                            </div>
                            <div class="submit">
                                <input type="submit" value="Submit Review">
                            </div>
                        </form>
                    </div>
                    <script>
                        document.getElementById('productReviewForm').addEventListener('submit', function(event) {
                            event.preventDefault();
        
                            const formData = new FormData(this);
        
                            formData.append('productUrl', window.location.href);
        
                            fetch('/portfolio-review-submit', {
                                method: 'POST',
                                body: formData,
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    alert('Thank you for your review!');
                                } else {
                                    alert('There was an issue submitting your review. Please try again.');
                                }
                            })
                            .catch(error => {
                                alert('An error occurred while submitting your review. Please try again.');
                            });
                        });
                    </script>

                    <style>
                        /* PRODUCT Review Form */
                        .productReviewForm {
                            margin: 50px 0px;
                            padding: 50px 0px;
                            border-top: 1px solid #EEF2F5;
                        }
                        .productReviewForm h3{
                            margin-bottom: 30px;
                            font-size: 40px !important;
                            font-weight: 600 !important;
                        }

                        .productReviewForm .stars {
                            display: flex;
                            flex-direction: row-reverse;
                            justify-content: flex-end;
                            gap: 3px;
                        }
                        #productReviewForm {
                            display: flex;
                            flex-direction: column;
                            gap: 10px;
                        }

                        .productReviewForm .stars input[type="radio"] {
                            display: none;
                        }

                        .productReviewForm .stars label {
                            font-size: 2rem;
                            color: #ccc;
                            cursor: pointer;
                        }

                        .productReviewForm .stars input[type="radio"]:checked ~ label {
                            color: #ff9900;
                        }

                        .productReviewForm .stars label:hover,
                        .productReviewForm .stars label:hover ~ label {
                            color: #ff9900;
                        }

                        .productReviewForm .review textarea {
                            width: 100%;
                            padding: 10px;
                            border-radius: 5px;
                            border: 1px solid #ccc;
                            margin-top: 10px;
                            font-size: 1rem;
                            font-family: Poppins;
                        }

                        .productReviewForm .submit {
                            margin-top: 10px;
                        }

                        .productReviewForm .submit input {
                            background-color: #23262F;
                            color: #fff;
                            padding: 10px 20px;
                            border: none;
                            border-radius: 5px;
                            cursor: pointer;
                            font-size: 1rem;
                        }
                        .productReviewForm  .rating > label {
                            font-weight: 500;
                        }
                        .productReviewForm  .review > label {
                            font-weight: 500;
                        }
                        .productReviewForm  .form-group > label {
                            font-weight: 500;
                            min-width: 95px;
                        }
                        .productReviewForm  .form-group {
                            display: flex;
                            gap: 11px;
                        }
                        .productReviewForm  .form-group > input {
                            padding: 5px 10px;
                            font-family: Poppins;
                            min-width: 12rem;
                        }
                        /* Product Review Form End */
                    </style>

                    {% endif %}
                    
                    

                </div>
                
                <div class="p-right-row">
                    <div class="enquiry-form">
                        <div class="enquiry-title">
                        <h2>Enquire with {{ architectProfile.getCompanyName() }}</h2>
                        </div>
                        {{ form(form) }}
                    </div>

                    <!-- <div class="enquiry-form" style="margin:30px 0px;">
                        <div class="hireProfessionalBox" style="display: flex; justify-content: center; flex-direction: column; align-items: center;">
                            <p class="Hire-Title">Want to Hire  {{ architectProfile.getCompanyName() }}?</p>
                            <a class="Hire-Button" href="/account/register">Sign Up Now</a>
                            <p class="Hire-Description">Sign Up as a Customer or Professional to Hire.</p>
                        </div>
                    </div> -->
                </div>
            </div>

            <style>
                .hireProfessionalBox {
                    display: flex;
                    justify-content: center;
                    flex-direction: column;
                    align-items: center;
                }
                .hireProfessionalBox a {
                    text-decoration: none;
                    padding: 10px 23px;
                    border-radius: .3rem;
                    border: 1px solid;
                    background-color: #1BA89D;
                    color: #fff;
                    margin: 20px 0px;
                }
                .hireProfessionalBox a:hover{
                    background-color: #000;
                }
                .hireProfessionalBox p {
                    text-align: center;
                }
                .hireProfessionalBox .Hire-Title {
                    font-weight: 700;
                }
                .hireProfessionalBox .Hire-Title {
                    
                }
            </style>

            

            {# <div class="otherdetails">
                <div class="established-year">
                    <p><i class="fa-solid fa-badge-check"></i> Year Established: {{ architectProfile.getYearEstablished() }}</p>
                </div>
                <div class="skills">
                    <p>Skills: {{ architectProfile.getSkills() }}</p>
                </div>
                <div class="specialization">
                {% if architectProfile.getspecialization() %}
                    <p>Specialization: {{ architectProfile.getspecialization() }}</p>
                {% endif %}
                </div>
                <div class="gstnumber">
                {% if architectProfile.gstnumber() %}
                    <p>GST Number: {{ architectProfile.getgstnumber() }}</p>
                {% endif %}
                </div>
            </div> #}

        </div>

        
        {# <div class="contact-details">
            <h2>Contact Information</h2>
            <div class="phone">
                <p>Phone: {{ architectProfile.getCountryCode() }} {{ architectProfile.getPhoneNumber() }}</p>
            </div>
            <div class="email">
                <p>Email: {{ architectProfile.getCustomer().getEmail() }}</p>
            </div>
            <div class="address">
                <p>Address: {{ architectProfile.getStreetAddress() }}, {{ architectProfile.getCity() }}, {{ architectProfile.getState() }}, {{ architectProfile.getCountry() }} {{ architectProfile.getPinCode() }}</p>
            </div>
        </div> #}

        
    </div>
{% endblock %}